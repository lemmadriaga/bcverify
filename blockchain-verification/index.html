<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tamper-Proof Financial Report Verification</title>
    <!-- <link rel="stylesheet" href="styles.css" /> -->
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css"
    />
  </head>
  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    /* Header Styles */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .company-info h1 {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .company-info p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .security-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255, 255, 255, 0.15);
      padding: 12px 20px;
      border-radius: 50px;
      backdrop-filter: blur(10px);
    }

    .security-badge i {
      font-size: 1.5rem;
    }

    /* Loading State */
    .loading-state {
      padding: 80px 40px;
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    /* Error State */
    .error-state {
      padding: 80px 40px;
      text-align: center;
    }

    .error-icon i {
      font-size: 4rem;
      color: #ef4444;
      margin-bottom: 20px;
    }

    .error-state h2 {
      font-size: 2rem;
      color: #ef4444;
      margin-bottom: 10px;
    }

    /* Status Banner */
    .status-banner {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 30px;
      margin: 30px;
      border-radius: 15px;
      border-left: 6px solid;
    }

    .status-banner.verified {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border-left-color: #10b981;
    }

    .status-banner.tampered {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      border-left-color: #ef4444;
    }

    .status-icon i {
      font-size: 3rem;
    }

    .status-text h2 {
      font-size: 1.8rem;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .status-text p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    /* Verification Details */
    .verification-details {
      margin: 30px;
      background: #f9fafb;
      border-radius: 15px;
      padding: 30px;
      border: 1px solid #e5e7eb;
    }

    .verification-details h3 {
      font-size: 1.5rem;
      color: #374151;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .detail-item label {
      font-weight: 600;
      color: #6b7280;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .detail-item span {
      font-family: "Courier New", monospace;
      font-size: 0.95rem;
      background: white;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      word-break: break-all;
    }

    .hash-value {
      color: #7c3aed;
      font-weight: 600;
    }

    .transaction-value {
      color: #059669;
      font-weight: 600;
    }

    .status-verified {
      color: #10b981 !important;
      font-weight: bold !important;
      background: #ecfdf5 !important;
      border-color: #a7f3d0 !important;
    }

    /* Document Viewer */
    .document-viewer {
      margin: 30px;
      background: #f9fafb;
      border-radius: 15px;
      padding: 30px;
      border: 1px solid #e5e7eb;
    }

    .document-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .document-header h3 {
      font-size: 1.5rem;
      color: #374151;
    }

    .document-actions {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .btn-primary,
    .btn-secondary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-secondary:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    /* PDF Container */
    .pdf-container {
      background: white;
      border-radius: 10px;
      padding: 20px;
      border: 1px solid #d1d5db;
      min-height: 600px;
    }

    .pdf-fallback {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 400px;
      color: #6b7280;
      text-align: center;
    }

    /* Security Notice */
    .security-notice {
      margin: 30px;
      background: linear-gradient(135deg, #fef3c7, #fed7aa);
      border-radius: 15px;
      padding: 30px;
      border-left: 6px solid #f59e0b;
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .notice-icon i {
      font-size: 2rem;
      color: #d97706;
    }

    .notice-content h4 {
      font-size: 1.3rem;
      color: #92400e;
      margin-bottom: 15px;
    }

    .notice-content ul {
      list-style: none;
      padding: 0;
    }

    .notice-content li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
      color: #78350f;
      line-height: 1.5;
    }

    .notice-content li::before {
      content: "✓";
      position: absolute;
      left: 0;
      color: #d97706;
      font-weight: bold;
    }

    /* Tampered State */
    .tampered-state {
      padding: 30px;
    }

    .tamper-warning {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 15px;
      padding: 30px;
      margin: 30px;
      border-left: 6px solid #ef4444;
    }

    .tamper-warning h3 {
      color: #dc2626;
      font-size: 1.5rem;
      margin-bottom: 15px;
    }

    .tamper-warning p {
      color: #7f1d1d;
      line-height: 1.6;
      margin-bottom: 10px;
    }

    /* Footer */
    .footer {
      background: #374151;
      color: white;
      padding: 30px;
      text-align: center;
    }

    .footer p {
      margin-bottom: 5px;
      opacity: 0.8;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        border-radius: 15px;
      }

      .header {
        padding: 20px;
      }

      .company-info h1 {
        font-size: 2rem;
      }

      .header-content {
        flex-direction: column;
        text-align: center;
      }

      .verification-details,
      .document-viewer,
      .security-notice,
      .tamper-warning {
        margin: 20px;
        padding: 20px;
      }

      .detail-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .document-header {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }

      .document-actions {
        justify-content: center;
      }

      .status-banner {
        flex-direction: column;
        text-align: center;
        margin: 20px;
        padding: 20px;
      }

      .security-notice {
        flex-direction: column;
        text-align: center;
      }
    }

    /* Print Styles */
    @media print {
      body {
        background: white;
        padding: 0;
      }

      .container {
        box-shadow: none;
        border-radius: 0;
      }

      .header,
      .footer,
      .document-actions,
      .security-notice {
        display: none !important;
      }

      .document-viewer {
        margin: 0;
        padding: 0;
        background: white;
        border: none;
      }

      .status-banner {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <div class="company-info">
            <h1>CYBERNEX INNOVATE</h1>
            <p>Document Verification System</p>
          </div>
          <div class="security-badge">
            <i class="fi fi-rr-shield-check"></i>
            <span>BLOCKCHAIN SECURED</span>
          </div>
        </div>
      </header>

      <!-- Loading State -->
      <div id="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Verifying document authenticity...</p>
      </div>

      <!-- Error State -->
      <div id="error" class="error-state" style="display: none">
        <div class="error-icon">
          <i class="fi fi-rr-cross-circle"></i>
        </div>
        <h2>Document Not Found</h2>
        <p>
          The requested document could not be verified. Please check the QR code
          and try again.
        </p>
      </div>

      <!-- Verification Results -->
      <div id="verified" class="verification-results" style="display: none">
        <!-- Status Banner -->
        <div class="status-banner verified">
          <div class="status-icon">
            <i class="fi fi-rr-shield-check"></i>
          </div>
          <div class="status-text">
            <h2>ORIGINAL - TAMPER-PROOF FINANCIAL REPORT</h2>
            <p>
              This document has been cryptographically verified and stored on
              the Solana blockchain
            </p>
          </div>
        </div>

        <!-- Blockchain Verification Details -->
        <div class="verification-details">
          <h3>Blockchain Verification Details</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Document Hash:</label>
              <span id="documentHash" class="hash-value">Loading...</span>
            </div>
            <div class="detail-item">
              <label>Transaction ID:</label>
              <span id="transactionId" class="transaction-value"
                >Loading...</span
              >
            </div>
            <div class="detail-item">
              <label>Timestamp:</label>
              <span id="timestamp">Loading...</span>
            </div>
            <div class="detail-item">
              <label>Network:</label>
              <span>Solana Devnet</span>
            </div>
            <div class="detail-item">
              <label>Status:</label>
              <span class="status-verified">✓ VERIFIED</span>
            </div>
          </div>
        </div>

        <!-- Document Viewer -->
        <div class="document-viewer">
          <div class="document-header">
            <h3>Original Financial Report</h3>
            <div class="document-actions">
              <button id="printBtn" class="btn-primary">
                <i class="fi fi-rr-print"></i>
                Print Document
              </button>
              <a
                id="solanaExplorerBtn"
                href="#"
                target="_blank"
                class="btn-secondary"
              >
                <i class="fi fi-rr-link"></i>
                View on Solana Explorer
              </a>
            </div>
          </div>

          <!-- PDF Viewer Container -->
          <div class="pdf-container">
            <embed
              id="pdfViewer"
              src=""
              type="application/pdf"
              width="100%"
              height="600px"
            />
            <div id="pdfFallback" class="pdf-fallback" style="display: none">
              <p>
                PDF viewer not supported. Please use the print button to view
                the document.
              </p>
            </div>
          </div>
        </div>

        <!-- Security Notice -->
        <div class="security-notice">
          <div class="notice-icon">
            <i class="fi fi-rr-info"></i>
          </div>
          <div class="notice-content">
            <h4>Security Information</h4>
            <ul>
              <li>
                This document is cryptographically hashed and stored on the
                Solana blockchain
              </li>
              <li>
                Any tampering or modification would result in a different hash,
                making it immediately detectable
              </li>
              <li>
                The document can only be printed, not edited or downloaded to
                prevent unauthorized changes
              </li>
              <li>
                Verification can be independently confirmed on the Solana
                blockchain explorer
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Tampered Document State -->
      <div
        id="tampered"
        class="verification-results tampered-state"
        style="display: none"
      >
        <div class="status-banner tampered">
          <div class="status-icon">
            <i class="fi fi-rr-cross-circle"></i>
          </div>
          <div class="status-text">
            <h2>DOCUMENT TAMPERED - NOT AUTHENTIC</h2>
            <p>
              This document has been modified and cannot be verified against
              blockchain records
            </p>
          </div>
        </div>

        <div class="tamper-warning">
          <h3>⚠️ Security Warning</h3>
          <p>
            The document hash does not match the blockchain records. This
            indicates the document has been tampered with or corrupted.
          </p>
          <p>
            Please request a new copy of the original document from the issuer.
          </p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>© 2025 CyberNex Innovate - Blockchain Document Verification System</p>
      <p>Powered by Solana Blockchain Technology</p>
    </footer>

    <script src="verification.js"></script>
  </body>
</html>
<script>
  /**
   * Storage API for cross-origin document access
   * This allows the verification website to access documents stored from the main app
   */

  // Configuration
  const STORAGE_PREFIX = "cybernex_doc_";
  const MAX_DOCUMENTS = 50; // Maximum documents to store
  const STORAGE_EXPIRY_DAYS = 30; // Documents expire after 30 days

  /**
   * Store document data for verification
   */
  function storeDocument(documentData) {
    try {
      const storageKey = `${STORAGE_PREFIX}${documentData.documentHash}`;
      const dataWithExpiry = {
        ...documentData,
        expiresAt: new Date(
          Date.now() + STORAGE_EXPIRY_DAYS * 24 * 60 * 60 * 1000
        ).toISOString(),
      };

      localStorage.setItem(storageKey, JSON.stringify(dataWithExpiry));

      // Update document index
      updateDocumentIndex(documentData.documentHash);

      return { success: true };
    } catch (error) {
      console.error("Error storing document:", error);
      return { success: false, error: error.message };
    }
  }

  /**
   * Retrieve document by hash
   */
  function getDocument(documentHash) {
    try {
      const storageKey = `${STORAGE_PREFIX}${documentHash}`;
      const storedData = localStorage.getItem(storageKey);

      if (!storedData) {
        return { success: false, reason: "not_found" };
      }

      const documentData = JSON.parse(storedData);

      // Check if document has expired
      if (
        documentData.expiresAt &&
        new Date(documentData.expiresAt) < new Date()
      ) {
        localStorage.removeItem(storageKey);
        return { success: false, reason: "expired" };
      }

      return { success: true, data: documentData };
    } catch (error) {
      console.error("Error retrieving document:", error);
      return { success: false, reason: "error", message: error.message };
    }
  }

  /**
   * Update document index for management
   */
  function updateDocumentIndex(documentHash) {
    try {
      const indexKey = "cybernex_document_index";
      const index = JSON.parse(localStorage.getItem(indexKey) || "[]");

      // Add new document hash if not exists
      if (!index.includes(documentHash)) {
        index.push(documentHash);
      }

      // Keep only the most recent documents
      if (index.length > MAX_DOCUMENTS) {
        const oldHashes = index.splice(0, index.length - MAX_DOCUMENTS);
        // Clean up old documents
        oldHashes.forEach((hash) => {
          localStorage.removeItem(`${STORAGE_PREFIX}${hash}`);
        });
      }

      localStorage.setItem(indexKey, JSON.stringify(index));
    } catch (error) {
      console.error("Error updating document index:", error);
    }
  }

  /**
   * Clean up expired documents
   */
  function cleanupExpiredDocuments() {
    try {
      const indexKey = "cybernex_document_index";
      const index = JSON.parse(localStorage.getItem(indexKey) || "[]");
      const validHashes = [];

      index.forEach((hash) => {
        const result = getDocument(hash);
        if (result.success) {
          validHashes.push(hash);
        }
      });

      localStorage.setItem(indexKey, JSON.stringify(validHashes));
    } catch (error) {
      console.error("Error cleaning up expired documents:", error);
    }
  }

  /**
   * Initialize storage system
   */
  function initializeStorage() {
    // Clean up expired documents on initialization
    cleanupExpiredDocuments();
  }

  // Export functions for use
  window.CyberNexStorage = {
    storeDocument,
    getDocument,
    cleanupExpiredDocuments,
    initializeStorage,
  };

  // Initialize on load
  initializeStorage();
</script>
<script>
  // Firebase configuration for the verification website
  // This is a standalone implementation that doesn't require Angular

  // Firebase configuration - use the same as your Ionic app
  const firebaseConfig = {
    apiKey: "AIzaSyARBa39DFIW6_QKyWMdvGNK9OS_LROy-dA",
    authDomain: "cybernex-d2ca7.firebaseapp.com",
    projectId: "cybernex-d2ca7",
    storageBucket: "cybernex-d2ca7.appspot.com",
    messagingSenderId: "150967057111",
    appId: "1:150967057111:web:02f51643e259beb4288e92",
  };

  // Initialize Firebase (will be loaded from CDN)
  let db = null;

  // Initialize Firebase when the page loads
  document.addEventListener("DOMContentLoaded", function () {
    initializeFirebase();
  });

  /**
   * Initialize Firebase and Firestore
   */
  function initializeFirebase() {
    try {
      // Initialize Firebase app
      const app = firebase.initializeApp(firebaseConfig);

      // Initialize Firestore
      db = firebase.firestore();

      console.log("✅ Firebase initialized successfully");
    } catch (error) {
      console.error("❌ Firebase initialization failed:", error);
    }
  }

  /**
   * Get document from Firestore by hash
   */
  async function getDocumentFromFirestore(documentHash) {
    if (!db) {
      throw new Error("Firebase not initialized");
    }

    try {
      const docRef = db.collection("verification_documents").doc(documentHash);
      const docSnap = await docRef.get();

      if (docSnap.exists) {
        const data = docSnap.data();

        // Check if document has expired
        const expiresAt = new Date(data.expiresAt);
        const now = new Date();

        if (expiresAt < now) {
          // Document has expired
          return {
            success: false,
            reason: "expired",
            message: "Document has expired. Documents are kept for 30 days.",
          };
        }

        return {
          success: true,
          data: data,
        };
      } else {
        return {
          success: false,
          reason: "not_found",
          message: "Document not found in database",
        };
      }
    } catch (error) {
      console.error("Error fetching document from Firestore:", error);
      return {
        success: false,
        reason: "error",
        message: "Error retrieving document: " + error.message,
      };
    }
  }

  /**
   * Check if document exists and is valid
   */
  async function checkDocumentStatus(documentHash) {
    if (!db) {
      return {
        success: false,
        reason: "firebase_error",
        message: "Database connection not available",
      };
    }

    try {
      const result = await getDocumentFromFirestore(documentHash);
      return result;
    } catch (error) {
      console.error("Error checking document status:", error);
      return {
        success: false,
        reason: "error",
        message: "Failed to check document status",
      };
    }
  }

  // Export functions for use in verification.js
  window.FirebaseDocumentService = {
    getDocument: getDocumentFromFirestore,
    checkStatus: checkDocumentStatus,
    isInitialized: () => db !== null,
  };
</script>
<script>
  // Global variables
  let documentData = null;
  let pdfBlob = null;

  // Initialize the verification process when page loads
  document.addEventListener("DOMContentLoaded", function () {
    initializeVerification();
  });

  /**
   * Initialize the document verification process
   */
  function initializeVerification() {
    // Get document hash from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const documentHash = urlParams.get("hash");
    const transactionId = urlParams.get("tx");

    if (!documentHash) {
      showError("No document hash provided");
      return;
    }

    // Start verification process
    verifyDocument(documentHash, transactionId);
  }

  /**
   * Verify document against stored records
   */
  async function verifyDocument(documentHash, transactionId) {
    try {
      showLoading();

      // Verify document by fetching from Firebase Firestore or localStorage
      const verificationResult = await verifyDocumentFromStorage(
        documentHash,
        transactionId
      );

      if (verificationResult.success) {
        showVerifiedDocument(verificationResult.data);
      } else {
        if (
          verificationResult.reason === "tampered" ||
          verificationResult.reason === "expired"
        ) {
          showTamperedDocument();
        } else {
          showError(verificationResult.message);
        }
      }
    } catch (error) {
      console.error("Verification error:", error);
      showError("Verification failed. Please try again.");
    }
  }

  /**
   * Verify document by fetching from Firebase Firestore
   */
  async function verifyDocumentFromStorage(documentHash, transactionId) {
    try {
      // Check if Firebase service is available
      if (
        !window.FirebaseDocumentService ||
        !window.FirebaseDocumentService.isInitialized()
      ) {
        console.error(
          "Firebase service not available, falling back to localStorage"
        );
        return verifyFromLocalStorage(documentHash, transactionId);
      }

      // Fetch document from Firestore
      const result = await window.FirebaseDocumentService.getDocument(
        documentHash
      );

      if (result.success) {
        const data = result.data;
        return {
          success: true,
          data: {
            documentHash: data.documentHash,
            transactionId: data.transactionId,
            timestamp: data.timestamp,
            walletAddress: data.walletAddress,
            isVerified: data.isVerified,
            pdfUrl: data.pdfDataUrl, // This contains the actual PDF data URL
            metadata: data.metadata,
          },
        };
      } else {
        return {
          success: false,
          reason: result.reason || "not_found",
          message: result.message || "Document not found or has expired",
        };
      }
    } catch (error) {
      console.error("Error verifying document:", error);

      // Fallback to localStorage
      console.log("Falling back to localStorage verification");
      return verifyFromLocalStorage(documentHash, transactionId);
    }
  }

  /**
   * Fallback verification using localStorage
   */
  function verifyFromLocalStorage(documentHash, transactionId) {
    try {
      const storedData = localStorage.getItem(`pdf_${documentHash}`);

      if (storedData) {
        const parsedData = JSON.parse(storedData);
        return {
          success: true,
          data: {
            documentHash: documentHash,
            transactionId: transactionId || "local-storage-" + Date.now(),
            timestamp: parsedData.timestamp,
            walletAddress: "7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU",
            isVerified: true,
            pdfUrl: parsedData.pdfDataUrl,
            metadata: parsedData.financialData,
          },
        };
      } else {
        return {
          success: false,
          reason: "not_found",
          message: "Document not found in local storage",
        };
      }
    } catch (error) {
      console.error("Error with localStorage verification:", error);
      return {
        success: false,
        reason: "error",
        message: "Error accessing stored document",
      };
    }
  }

  /**
   * Convert data URL to blob for PDF handling
   */
  function dataURLToBlob(dataURL) {
    const arr = dataURL.split(",");
    const mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while (n--) {
      u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], { type: mime });
  }

  /**
   * Show loading state
   */
  function showLoading() {
    hideAllStates();
    document.getElementById("loading").style.display = "block";
  }

  /**
   * Show error state
   */
  function showError(message) {
    hideAllStates();
    const errorElement = document.getElementById("error");
    errorElement.style.display = "block";
    errorElement.querySelector("p").textContent = message;
  }

  /**
   * Show verified document
   */
  function showVerifiedDocument(data) {
    hideAllStates();
    documentData = data;

    const verifiedElement = document.getElementById("verified");
    verifiedElement.style.display = "block";

    // Populate verification details
    document.getElementById("documentHash").textContent = data.documentHash;
    document.getElementById("transactionId").textContent = data.transactionId;
    document.getElementById("timestamp").textContent = new Date(
      data.timestamp
    ).toLocaleString();

    // Set up Solana explorer link
    const explorerBtn = document.getElementById("solanaExplorerBtn");
    explorerBtn.href = `https://explorer.solana.com/tx/${data.transactionId}?cluster=devnet`;

    // Load PDF if available
    if (data.pdfUrl) {
      loadPDF(data.pdfUrl);
    }

    // Set up print button
    document
      .getElementById("printBtn")
      .addEventListener("click", printDocument);
  }

  /**
   * Show tampered document state
   */
  function showTamperedDocument() {
    hideAllStates();
    document.getElementById("tampered").style.display = "block";
  }

  /**
   * Hide all state elements
   */
  function hideAllStates() {
    document.getElementById("loading").style.display = "none";
    document.getElementById("error").style.display = "none";
    document.getElementById("verified").style.display = "none";
    document.getElementById("tampered").style.display = "none";
  }

  /**
   * Load PDF into viewer
   */
  function loadPDF(pdfUrl) {
    const pdfViewer = document.getElementById("pdfViewer");
    const pdfFallback = document.getElementById("pdfFallback");

    try {
      // Check if pdfUrl is a data URL (base64 encoded PDF)
      if (pdfUrl.startsWith("data:application/pdf")) {
        // Convert data URL to blob for proper PDF handling
        const blob = dataURLToBlob(pdfUrl);
        const blobUrl = URL.createObjectURL(blob);

        pdfViewer.src = blobUrl;
        pdfViewer.style.display = "block";
        pdfFallback.style.display = "none";

        // Store PDF blob for printing
        pdfBlob = blob;
      } else {
        // Handle regular URL
        pdfViewer.src = pdfUrl;
        pdfViewer.style.display = "block";
        pdfFallback.style.display = "none";

        // Store PDF blob for printing
        fetch(pdfUrl)
          .then((response) => response.blob())
          .then((blob) => {
            pdfBlob = blob;
          })
          .catch((error) => {
            console.warn("Could not fetch PDF for printing:", error);
          });
      }

      // Handle PDF load errors
      pdfViewer.onerror = function () {
        console.error("PDF viewer failed to load PDF");
        pdfViewer.style.display = "none";
        pdfFallback.style.display = "block";
      };
    } catch (error) {
      console.error("Error loading PDF:", error);
      pdfViewer.style.display = "none";
      pdfFallback.style.display = "block";
    }
  }

  /**
   * Print the document
   */
  function printDocument() {
    if (pdfBlob) {
      // Create a new window for printing the PDF
      const printWindow = window.open();
      const pdfUrl = URL.createObjectURL(pdfBlob);

      printWindow.document.write(`
            <html>
            <head>
                <title>Print Financial Report</title>
                <style>
                    body { margin: 0; padding: 0; }
                    embed { width: 100vw; height: 100vh; }
                </style>
            </head>
            <body>
                <embed src="${pdfUrl}" type="application/pdf" width="100%" height="100%">
            </body>
            </html>
        `);

      printWindow.document.close();

      // Auto-print after a short delay
      setTimeout(() => {
        printWindow.print();
      }, 1000);
    } else {
      // Fallback: print the current page
      window.print();
    }
  }

  /**
   * Copy text to clipboard
   */
  function copyToClipboard(text) {
    navigator.clipboard
      .writeText(text)
      .then(function () {
        // Show success message
        console.log("Copied to clipboard");
      })
      .catch(function (err) {
        console.error("Could not copy text: ", err);
      });
  }

  /**
   * Format date for display
   */
  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
    });
  }

  /**
   * Truncate hash for display
   */
  function truncateHash(hash, length = 16) {
    if (hash.length <= length) return hash;
    return hash.substr(0, length / 2) + "..." + hash.substr(-length / 2);
  }

  // Add click handlers for hash values to copy to clipboard
  document.addEventListener("DOMContentLoaded", function () {
    setTimeout(() => {
      const hashElements = document.querySelectorAll(
        ".hash-value, .transaction-value"
      );
      hashElements.forEach((element) => {
        element.style.cursor = "pointer";
        element.title = "Click to copy";
        element.addEventListener("click", function () {
          copyToClipboard(this.textContent);
        });
      });
    }, 100);
  });

  // Handle mobile responsiveness for PDF viewer
  window.addEventListener("resize", function () {
    const pdfViewer = document.getElementById("pdfViewer");
    if (pdfViewer && window.innerWidth < 768) {
      pdfViewer.style.height = "400px";
    } else if (pdfViewer) {
      pdfViewer.style.height = "600px";
    }
  });

  // Prevent right-click context menu to discourage tampering attempts
  document.addEventListener("contextmenu", function (e) {
    e.preventDefault();
  });

  // Disable certain keyboard shortcuts
  document.addEventListener("keydown", function (e) {
    // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
    if (
      e.keyCode === 123 ||
      (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
      (e.ctrlKey && e.keyCode === 85)
    ) {
      e.preventDefault();
      return false;
    }
  });
</script>
